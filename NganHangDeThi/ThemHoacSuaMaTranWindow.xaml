<Window x:Class="NganHangDeThi.ThemHoacSuaMaTranWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:uc="clr-namespace:NganHangDeThi.MyUserControl" xmlns:local2="clr-namespace:NganHangDeThi.Helpers" xmlns:Icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
        Title="Thêm hoặc Sửa Ma Trận" Height="500" Width="1200"
        WindowStyle="None"
        WindowStartupLocation="CenterScreen"
        xmlns:local1="clr-namespace:NganHangDeThi.Converters">

    <Window.Resources>
        <local1:IndexConverter x:Key="IndexConverter" />
    </Window.Resources>
    
    <Border Background="#ffffff" MouseDown="Border_MouseDown" Padding="20">
        <Border.Effect>
            <DropShadowEffect Direction="-130" BlurRadius="30" ShadowDepth="5" Opacity="0.1"/>
        </Border.Effect>
        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!--Title-->
            <Grid Grid.Row="0" Margin="20 0 20 0">
                <TextBlock TextAlignment="Center" FontWeight="SemiBold" Text="TẠO MA TRẬN" Foreground="#374655" FontSize="18" Margin="15 0 0 0" VerticalAlignment="Center"/>
            </Grid>

            <!-- Tên ma trận -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <uc:MyTextBoxControl Grid.Column="0" x:Name="TxtTen" Caption="Tên ma trận" Hint="Nhập tên ma trận" />
                <Grid Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="auto" />
                    </Grid.ColumnDefinitions>
                    <uc:MyTextBoxControl Grid.Column="0" x:Name="TxtSoCau" Caption="Số câu" Hint="Nhập số lượng câu hỏi" />
                    <StackPanel Margin="0 0 0 10" Grid.Column="1" VerticalAlignment="Bottom">
                        <Button Name="BtnThemChiTiet" Click="BtnThemChiTiet_Click" Width="140" Style="{StaticResource AddButton}" Margin="0 0 20 0">
                            <StackPanel Orientation="Horizontal">
                                <Icon:PackIconMaterial Kind="Plus" VerticalAlignment="Center" Width="11" Height="11" Margin="0 1 8 0" />
                                <TextBlock Text="Thêm" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>

            <!-- Nhập chi tiết -->
            <Grid Margin="0 6 0 0" Grid.Row="2" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!--Môn học-->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Môn học" FontFamily="13" FontWeight="SemiBold" Margin="18 0 10 0"
                        Foreground="#121518" HorizontalAlignment="Left" VerticalAlignment="Center" />
                    <ComboBox x:Name="CbbMonHoc" Style="{StaticResource ComboBoxFlatStyle}" Width="200" Margin="10 0"
                            DisplayMemberPath="TenMon" SelectedValuePath="Id" />
                </StackPanel>
                <!--Chương-->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="Chương" FontFamily="13" FontWeight="SemiBold" Margin="18 0 10 0"
                        Foreground="#121518" HorizontalAlignment="Left" VerticalAlignment="Center" />
                    <ComboBox x:Name="CbbChuong" Style="{StaticResource ComboBoxFlatStyle}" Width="200" Margin="10 0"
                            DisplayMemberPath="TenChuong" SelectedValuePath="Id" />
                </StackPanel>
                <!--Muc do-->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock Padding="8" Text="Mức độ" FontFamily="13" FontWeight="SemiBold" Margin="12 0 10 0"
                            Foreground="#121518" HorizontalAlignment="Left" VerticalAlignment="Center" />
                    <ComboBox x:Name="CbbMucDo" Style="{StaticResource ComboBoxFlatStyle}" 
                              Width="200" Margin="10 0" DisplayMemberPath="Value"
                             SelectedValuePath="Key"
                          />
                </StackPanel>

                <!--Loai-->
                <StackPanel Grid.Column="3" Orientation="Horizontal">
                    <TextBlock Text="Loại" FontFamily="13" FontWeight="SemiBold" Margin="18 0 10 0"
                        Foreground="#121518" HorizontalAlignment="Left" VerticalAlignment="Center" />
                    <ComboBox x:Name="CbbLoai" Style="{StaticResource ComboBoxFlatStyle}" 
                              Width="200" Margin="10 0" DisplayMemberPath="Value"
                            SelectedValuePath="Key"/>
                </StackPanel>
            </Grid>

            <!-- Hiển thị tổng số câu hỏi có sẵn -->
            <TextBlock x:Name="TxtThongTinBoLoc"
                   Grid.Row="3"
                   TextWrapping="Wrap"
                   FontStyle="Italic"
                   Foreground="DarkSlateGray"
                   FontSize="12"
                   Margin="0 0 0 10"/>

            <!-- Bảng chi tiết -->
            <DataGrid RowStyle="{DynamicResource DataGridRowStyle1}" 
                      ColumnHeaderStyle="{DynamicResource DataGridColumnHeaderStyle1}" 
                      CellStyle="{DynamicResource DataGridCellStyle1}" 
                      Style="{DynamicResource DataGridStyle1}"
                      x:Name="DgChiTiet"
                    Grid.Row="4"
                    AutoGenerateColumns="False"
                    ItemsSource="{Binding DsChiTietMaTran}"
                    CanUserAddRows="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Chương" Binding="{Binding Chuong.TenChuong}" IsReadOnly="True" Width="auto" />
                    <DataGridTextColumn Header="Mức độ" Binding="{Binding MucDoCauHoi}" IsReadOnly="True" Width="auto" />
                    <DataGridTextColumn Header="Loại" Binding="{Binding LoaiCauHoi}" IsReadOnly="True" Width="auto" />
                    <DataGridTextColumn Header="Số câu" Binding="{Binding SoCau}" IsReadOnly="True" Width="auto" />
                    
                    <DataGridTemplateColumn Header="Thao tác" IsReadOnly="True" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Click="BtnXoaChiTiet_Click" Style="{StaticResource GridRemoveButton}" Tag="{Binding}" ToolTip="Xóa" Margin="5 0 0 0">
                                        <Icon:PackIconMaterial Kind="DeleteOffOutline" Style="{StaticResource GridButtonIcon}" />
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Button -->
            <Border Grid.Row="5" Height="60" Background="#f6f6f6" Margin="0 10 0 0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left">
                        <TextBlock FontWeight="SemiBold" Text="{Binding TongSoCau, StringFormat='Tổng số câu trong ma trận: {0}'}"
                            VerticalAlignment="Center" Margin="18 0 20 0"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Grid.Row="0" Content="Hủy" HorizontalAlignment="Left" Margin="20 0 10 0" Style="{StaticResource BackButton}" Width="150" Name="BtnHuy" Click="BtnHuy_Click"/>
                        <Button Grid.Column="1" Name="BtnLuu" Click="BtnLuu_Click" Content="Lưu" HorizontalAlignment="Right" Margin="0 0 20 0" Style="{StaticResource SaveButton}">
                            <Button.Effect>
                                <DropShadowEffect Direction="-120" BlurRadius="10" Opacity="0.3" ShadowDepth="5" Color="#4880FF"/>
                            </Button.Effect>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

    </Border>
</Window>
